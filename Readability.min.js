/*eslint-env es6:false*/
function Readability(e,t,i){i=i||{},this._uri=e,this._doc=t,this._biggestFrame=!1,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._debug=!!i.debug,this._maxElemsToParse=i.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=i.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._maxPages=i.maxPages||this.DEFAULT_MAX_PAGES,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._parsedPages={},this._pageETags={},this._curPageNum=1
var a
this._debug?(a=function(e){var t=e.nodeName+" "
if(e.nodeType==e.TEXT_NODE)return t+'("'+e.textContent+'")'
var i=e.className&&"."+e.className.replace(/ /g,"."),a=""
return e.id?a="(#"+e.id+i+")":i&&(a="("+i+")"),t+a},this.log=function(){if("undefined"!=typeof dump){var e=Array.prototype.map.call(arguments,function(e){return e&&e.nodeName?a(e):e}).join(" ")
dump("Reader: (Readability) "+e+"\n")}else if("undefined"!=typeof console){var t=["Reader: (Readability) "].concat(arguments)
console.log.apply(console,t)}}):this.log=function(){}}Readability.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_MAX_PAGES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),REGEXPS:{unlikelyCandidates:/banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|foot|header|legends|menu|modal|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|masthead|media|meta|modal|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?(dailymotion|youtube|youtube-nocookie|player\.vimeo)\.com/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,whitespace:/^\s*$/,hasContent:/\S$/},DIV_TO_P_ELEMS:["A","BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL","SELECT"],ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],_postProcessContent:function(e){this._fixRelativeUris(e)},_removeNodes:function(e,t){for(var i=e.length-1;i>=0;i--){var a=e[i],n=a.parentNode
n&&(t&&!t.call(this,a,i,e)||n.removeChild(a))}},_replaceNodeTags:function(e,t){for(var i=e.length-1;i>=0;i--){var a=e[i]
this._setNodeTag(a,t)}},_forEachNode:function(e,t){Array.prototype.forEach.call(e,t,this)},_someNode:function(e,t){return Array.prototype.some.call(e,t,this)},_concatNodeLists:function(){var e=Array.prototype.slice,t=e.call(arguments),i=t.map(function(t){return e.call(t)})
return Array.prototype.concat.apply([],i)},_getAllNodesWithTag:function(e,t){return e.querySelectorAll?e.querySelectorAll(t.join(",")):[].concat.apply([],t.map(function(t){var i=e.getElementsByTagName(t)
return Array.isArray(i)?i:Array.from(i)}))},_fixRelativeUris:function(e){function t(e){return/^[a-zA-Z][a-zA-Z0-9\+\-\.]*:/.test(e)?e:"//"==e.substr(0,2)?i+"://"+e.substr(2):"/"==e[0]?a+e:0===e.indexOf("./")?n+e.slice(2):"#"==e[0]?e:n+e}var i=this._uri.scheme,a=this._uri.prePath,n=this._uri.pathBase,r=e.getElementsByTagName("a")
this._forEachNode(r,function(e){var i=e.getAttribute("href")
if(i)if(0===i.indexOf("javascript:")){var a=this._doc.createTextNode(e.textContent)
e.parentNode.replaceChild(a,e)}else e.setAttribute("href",t(i))})
var s=e.getElementsByTagName("img")
this._forEachNode(s,function(e){var i=e.getAttribute("src")
i&&e.setAttribute("src",t(i))})},_getArticleTitle:function(){function e(e){return e.split(/\s+/).length}var t=this._doc,i="",a=""
try{i=a=t.title,"string"!=typeof i&&(i=a=this._getInnerText(t.getElementsByTagName("title")[0]))}catch(e){}var n=!1
if(/ [\|\-\\\/>»] /.test(i))n=/ [\\\/>»] /.test(i),i=a.replace(/(.*)[\|\-\\\/>»] .*/gi,"$1"),e(i)<3&&(i=a.replace(/[^\|\-\\\/>»]*[\|\-\\\/>»](.*)/gi,"$1"))
else if(-1!==i.indexOf(": ")){var r=this._concatNodeLists(t.getElementsByTagName("h1"),t.getElementsByTagName("h2")),s=this._someNode(r,function(e){return e.textContent===i})
s||(i=a.substring(a.lastIndexOf(":")+1),e(i)<3&&(i=a.substring(a.indexOf(":")+1)))}else if(i.length>150||i.length<15){var o=t.getElementsByTagName("h1")
1===o.length&&(i=this._getInnerText(o[0]))}i=i.trim()
var l=e(i)
return l<=4&&(!n||l!=e(a.replace(/[\|\-\\\/>»]+/g,""))-1)&&(i=a),i},_prepDocument:function(){var e=this._doc
this._removeNodes(e.getElementsByTagName("style")),e.body&&this._replaceBrs(e.body),this._replaceNodeTags(e.getElementsByTagName("font"),"SPAN")},_nextElement:function(e){for(var t=e;t&&t.nodeType!=Node.ELEMENT_NODE&&this.REGEXPS.whitespace.test(t.textContent);)t=t.nextSibling
return t},_replaceBrs:function(e){this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){for(var t=e.nextSibling,i=!1;(t=this._nextElement(t))&&"BR"==t.tagName;){i=!0
var a=t.nextSibling
t.parentNode.removeChild(t),t=a}if(i){var n=this._doc.createElement("p")
for(e.parentNode.replaceChild(n,e),t=n.nextSibling;t;){if("BR"==t.tagName){var r=this._nextElement(t)
if(r&&"BR"==r.tagName)break}var s=t.nextSibling
n.appendChild(t),t=s}}})},_setNodeTag:function(e,t){if(this.log("_setNodeTag",e,t),e.__JSDOMParser__)return e.localName=t.toLowerCase(),e.tagName=t.toUpperCase(),e
for(var i=e.ownerDocument.createElement(t);e.firstChild;)i.appendChild(e.firstChild)
e.parentNode.replaceChild(i,e),e.readability&&(i.readability=e.readability)
for(var a=0;a<e.attributes.length;a++)i.setAttribute(e.attributes[a].name,e.attributes[a].value)
return i},_prepArticle:function(e){this._cleanStyles(e),this._markDataTables(e),this._cleanConditionally(e,"form"),this._cleanConditionally(e,"fieldset"),this._clean(e,"object"),this._clean(e,"embed"),this._clean(e,"h1"),this._clean(e,"footer"),this._forEachNode(e.children,function(e){this._cleanMatchedNodes(e,/share/)})
var t=e.getElementsByTagName("h2")
if(1===t.length){var i=(t[0].textContent.length-this._articleTitle.length)/this._articleTitle.length
Math.abs(i)<.5&&(i>0?t[0].textContent.includes(this._articleTitle):this._articleTitle.includes(t[0].textContent))&&this._clean(e,"h2")}this._clean(e,"iframe"),this._clean(e,"input"),this._clean(e,"textarea"),this._clean(e,"select"),this._clean(e,"button"),this._cleanHeaders(e),this._cleanConditionally(e,"table"),this._cleanConditionally(e,"ul"),this._cleanConditionally(e,"div"),this._removeNodes(e.getElementsByTagName("p"),function(e){return 0===e.getElementsByTagName("img").length+e.getElementsByTagName("embed").length+e.getElementsByTagName("object").length+e.getElementsByTagName("iframe").length&&!this._getInnerText(e,!1)}),this._forEachNode(this._getAllNodesWithTag(e,["br"]),function(e){var t=this._nextElement(e.nextSibling)
t&&"P"==t.tagName&&e.parentNode.removeChild(e)})},_initializeNode:function(e){switch(e.readability={contentScore:0},e.tagName){case"DIV":e.readability.contentScore+=5
break
case"PRE":case"TD":case"BLOCKQUOTE":e.readability.contentScore+=3
break
case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":e.readability.contentScore-=3
break
case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":e.readability.contentScore-=5}e.readability.contentScore+=this._getClassWeight(e)},_removeAndGetNext:function(e){var t=this._getNextNode(e,!0)
return e.parentNode.removeChild(e),t},_getNextNode:function(e,t){if(!t&&e.firstElementChild)return e.firstElementChild
if(e.nextElementSibling)return e.nextElementSibling
do{e=e.parentNode}while(e&&!e.nextElementSibling)
return e&&e.nextElementSibling},_getNextNodeNoElementProperties:function(e,t){function i(e){do{e=e.nextSibling}while(e&&e.nodeType!==e.ELEMENT_NODE)
return e}if(!t&&e.children[0])return e.children[0]
var a=i(e)
if(a)return a
do{(e=e.parentNode)&&(a=i(e))}while(e&&!a)
return e&&a},_checkByline:function(e,t){if(this._articleByline)return!1
if(void 0!==e.getAttribute)var i=e.getAttribute("rel")
return!("author"!==i&&!this.REGEXPS.byline.test(t)||!this._isValidByline(e.textContent))&&(this._articleByline=e.textContent.trim(),!0)},_getNodeAncestors:function(e,t){t=t||0
for(var i=0,a=[];e.parentNode&&(a.push(e.parentNode),!t||++i!==t);)e=e.parentNode
return a},_grabArticle:function(e){this.log("**** grabArticle ****")
var t=this._doc,i=null!==e
if(!(e=e||this._doc.body))return this.log("No body found in document. Abort."),null
for(var a=e.innerHTML;;){for(var n=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),r=[],s=this._doc.documentElement;s;){var o=s.className+" "+s.id
if(this._checkByline(s,o))s=this._removeAndGetNext(s)
else if(n&&this.REGEXPS.unlikelyCandidates.test(o)&&!this.REGEXPS.okMaybeItsACandidate.test(o)&&"BODY"!==s.tagName&&"A"!==s.tagName)this.log("Removing unlikely candidate - "+o),s=this._removeAndGetNext(s)
else if("DIV"!==s.tagName&&"SECTION"!==s.tagName&&"HEADER"!==s.tagName&&"H1"!==s.tagName&&"H2"!==s.tagName&&"H3"!==s.tagName&&"H4"!==s.tagName&&"H5"!==s.tagName&&"H6"!==s.tagName||!this._isElementWithoutContent(s)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(s.tagName)&&r.push(s),"DIV"===s.tagName)if(this._hasSinglePInsideElement(s)){var l=s.children[0]
s.parentNode.replaceChild(l,s),s=l}else this._hasChildBlockElement(s)?this._forEachNode(s.childNodes,function(e){if(e.nodeType===Node.TEXT_NODE&&e.textContent.trim().length>0){var i=t.createElement("p")
i.textContent=e.textContent,i.style.display="inline",i.className="readability-styled",s.replaceChild(i,e)}}):(s=this._setNodeTag(s,"P"),r.push(s))
s=this._getNextNode(s)}else s=this._removeAndGetNext(s)}var c=[]
this._forEachNode(r,function(e){if(e.parentNode&&void 0!==e.parentNode.tagName){var t=this._getInnerText(e)
if(!(t.length<25)){var i=this._getNodeAncestors(e,3)
if(0!==i.length){var a=0
a+=1,a+=t.split(",").length,a+=Math.min(Math.floor(t.length/100),3),this._forEachNode(i,function(e,t){if(e.tagName){if(void 0===e.readability&&(this._initializeNode(e),c.push(e)),0===t)var i=1
else i=1===t?2:3*t
e.readability.contentScore+=a/i}})}}}})
for(var h=[],d=0,g=c.length;d<g;d+=1){var u=c[d],_=u.readability.contentScore*(1-this._getLinkDensity(u))
u.readability.contentScore=_,this.log("Candidate:",u,"with score "+_)
for(var m=0;m<this._nbTopCandidates;m++){var f=h[m]
if(!f||_>f.readability.contentScore){h.splice(m,0,u),h.length>this._nbTopCandidates&&h.pop()
break}}}var p,N=h[0]||null,E=!1
if(null===N||"BODY"===N.tagName){N=t.createElement("DIV"),E=!0
for(var v=e.childNodes;v.length;)this.log("Moving child out:",v[0]),N.appendChild(v[0])
e.appendChild(N),this._initializeNode(N)}else if(N){for(var y=[],b=1;b<h.length;b++)h[b].readability.contentScore/N.readability.contentScore>=.75&&y.push(this._getNodeAncestors(h[b]))
if(y.length>=3)for(p=N.parentNode;"BODY"!==p.tagName;){for(var T=0,A=0;A<y.length&&T<3;A++)T+=Number(y[A].includes(p))
if(T>=3){N=p
break}p=p.parentNode}N.readability||this._initializeNode(N),p=N.parentNode
for(var x=N.readability.contentScore,S=x/3;"BODY"!==p.tagName;)if(p.readability){var C=p.readability.contentScore
if(C<S)break
if(C>x){N=p
break}x=p.readability.contentScore,p=p.parentNode}else p=p.parentNode
for(p=N.parentNode;"BODY"!=p.tagName&&1==p.children.length;)N=p,p=N.parentNode
N.readability||this._initializeNode(N)}var L=t.createElement("DIV")
i&&(L.id="readability-content")
var P=Math.max(10,.2*N.readability.contentScore)
p=N.parentNode
for(var I=p.children,D=0,B=I.length;D<B;D++){var R=I[D],O=!1
if(this.log("Looking at sibling node:",R,R.readability?"with score "+R.readability.contentScore:""),this.log("Sibling has score",R.readability?R.readability.contentScore:"Unknown"),R===N)O=!0
else{var G=0
if(R.className===N.className&&""!==N.className&&(G+=.2*N.readability.contentScore),R.readability&&R.readability.contentScore+G>=P)O=!0
else if("P"===R.nodeName){var M=this._getLinkDensity(R),k=this._getInnerText(R),H=k.length
H>80&&M<.25?O=!0:H<80&&H>0&&0===M&&-1!==k.search(/\.( |$)/)&&(O=!0)}}O&&(this.log("Appending node:",R),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(R.nodeName)&&(this.log("Altering sibling:",R,"to div."),R=this._setNodeTag(R,"DIV")),L.appendChild(R),D-=1,B-=1)}if(this._debug&&this.log("Article content pre-prep: "+L.innerHTML),this._prepArticle(L),this._debug&&this.log("Article content post-prep: "+L.innerHTML),1===this._curPageNum)if(E)N.id="readability-page-1",N.className="page"
else{var w=t.createElement("DIV")
w.id="readability-page-1",w.className="page"
for(var X=L.childNodes;X.length;)w.appendChild(X[0])
L.appendChild(w)}if(this._debug&&this.log("Article content after paging: "+L.innerHTML),!(this._getInnerText(L,!0).length<500)){var F=[p,N].concat(this._getNodeAncestors(p))
return this._someNode(F,function(e){if(!e.tagName)return!1
var t=e.getAttribute("dir")
return!!t&&(this._articleDir=t,!0)}),L}if(e.innerHTML=a,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS)
else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES)
else{if(!this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))return null
this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY)}}},_isValidByline:function(e){return("string"==typeof e||e instanceof String)&&(e=e.trim(),e.length>0&&e.length<100)},_getArticleMetadata:function(){var e={},t={},i=this._doc.getElementsByTagName("meta"),a=/^\s*((twitter)\s*:\s*)?(description|title)\s*$/gi,n=/^\s*og\s*:\s*(description|title)\s*$/gi
return this._forEachNode(i,function(i){var r=i.getAttribute("name"),s=i.getAttribute("property")
if(-1!==[r,s].indexOf("author"))return void(e.byline=i.getAttribute("content"))
var o=null
if(a.test(r)?o=r:n.test(s)&&(o=s),o){var l=i.getAttribute("content")
l&&(o=o.toLowerCase().replace(/\s/g,""),t[o]=l.trim())}}),"description"in t?e.excerpt=t.description:"og:description"in t?e.excerpt=t["og:description"]:"twitter:description"in t&&(e.excerpt=t["twitter:description"]),e.title=this._getArticleTitle(),e.title||("og:title"in t?e.title=t["og:title"]:"twitter:title"in t&&(e.title=t["twitter:title"])),e},_removeScripts:function(e){this._removeNodes(e.getElementsByTagName("script"),function(e){return e.nodeValue="",e.removeAttribute("src"),!0}),this._removeNodes(e.getElementsByTagName("noscript"))},_hasSinglePInsideElement:function(e){return 1==e.children.length&&"P"===e.children[0].tagName&&!this._someNode(e.childNodes,function(e){return e.nodeType===Node.TEXT_NODE&&this.REGEXPS.hasContent.test(e.textContent)})},_isElementWithoutContent:function(e){return e.nodeType===Node.ELEMENT_NODE&&0==e.textContent.trim().length&&(0==e.children.length||e.children.length==e.getElementsByTagName("br").length+e.getElementsByTagName("hr").length)},_hasChildBlockElement:function(e){return this._someNode(e.childNodes,function(e){return-1!==this.DIV_TO_P_ELEMS.indexOf(e.tagName)||this._hasChildBlockElement(e)})},_getInnerText:function(e,t){t=void 0===t||t
var i=e.textContent.trim()
return t?i.replace(this.REGEXPS.normalize," "):i},_getCharCount:function(e,t){return t=t||",",this._getInnerText(e).split(t).length-1},_cleanStyles:function(e){if(e=e||this._doc){var t=e.firstChild
for("function"==typeof e.removeAttribute&&"readability-styled"!==e.className&&e.removeAttribute("style");null!==t;)t.nodeType===t.ELEMENT_NODE&&("readability-styled"!==t.className&&t.removeAttribute("style"),this._cleanStyles(t)),t=t.nextSibling}},_getLinkDensity:function(e){var t=this._getInnerText(e).length
if(0===t)return 0
var i=0
return this._forEachNode(e.getElementsByTagName("a"),function(e){i+=this._getInnerText(e).length}),i/t},_findBaseUrl:function(){for(var e=this._uri,t=e.path.split("?")[0],i=t.split("/").reverse(),a=[],n="",r=0,s=i.length;r<s;r+=1){var o=i[r];-1!==o.indexOf(".")&&(n=o.split(".")[1],n.match(/[^a-zA-Z]/)||(o=o.split(".")[0])),!o.match(/((_|-)?p[a-z]*|(_|-))[0-9]{1,2}$/i)||1!==r&&0!==r||(o=o.replace(/((_|-)?p[a-z]*|(_|-))[0-9]{1,2}$/i,""))
var l=!1
r<2&&o.match(/^\d{1,2}$/)&&(l=!0),0===r&&"index"===o.toLowerCase()&&(l=!0),r<2&&o.length<3&&!i[0].match(/[a-z]/i)&&(l=!0),l||a.push(o)}return e.scheme+"://"+e.host+a.reverse().join("/")},_findNextPageLink:function(e){for(var t=this._uri,i={},a=e.getElementsByTagName("a"),n=this._findBaseUrl(),r=0,s=a.length;r<s;r+=1){var o=a[r],l=a[r].href.replace(/#.*$/,"").replace(/\/$/,"")
if(!(""===l||l===n||l===t.spec||l in this._parsedPages)&&t.host===l.split(/\/+/g)[1]){var c=this._getInnerText(o)
if(!(c.match(this.REGEXPS.extraneous)||c.length>25)){if(l.replace(n,"").match(/\d/)){l in i?i[l].linkText+=" | "+c:i[l]={score:0,linkText:c,href:l}
var h=i[l]
0!==l.indexOf(n)&&(h.score-=25)
var d=c+" "+o.className+" "+o.id
d.match(this.REGEXPS.nextLink)&&(h.score+=50),d.match(/pag(e|ing|inat)/i)&&(h.score+=25),d.match(/(first|last)/i)&&(h.linkText.match(this.REGEXPS.nextLink)||(h.score-=65)),(d.match(this.REGEXPS.negative)||d.match(this.REGEXPS.extraneous))&&(h.score-=50),d.match(this.REGEXPS.prevLink)&&(h.score-=200)
for(var g=o.parentNode,u=!1,_=!1;g;){var m=g.className+" "+g.id
!u&&m&&m.match(/pag(e|ing|inat)/i)&&(u=!0,h.score+=25),!_&&m&&m.match(this.REGEXPS.negative)&&(m.match(this.REGEXPS.positive)||(h.score-=25,_=!0)),g=g.parentNode}(l.match(/p(a|g|ag)?(e|ing|ination)?(=|\/)[0-9]{1,2}/i)||l.match(/(page|paging)/i))&&(h.score+=25),l.match(this.REGEXPS.extraneous)&&(h.score-=15)
var f=parseInt(c,10)
f&&(1===f?h.score-=10:h.score+=Math.max(0,10-f))}}}}var p=null
for(var N in i)i.hasOwnProperty(N)&&i[N].score>=50&&(!p||p.score<i[N].score)&&(p=i[N])
var E=null
return p&&(E=p.href.replace(/\/$/,""),this.log("NEXT PAGE IS "+E),this._parsedPages[E]=!0),E},_successfulRequest:function(e){return e.status>=200&&e.status<300||304===e.status||0===e.status&&e.responseText},_ajax:function(e,t){function i(e){4===a.readyState&&(this._successfulRequest(a)?t.success&&t.success(a):t.error&&t.error(a))}var a=new XMLHttpRequest
void 0===t&&(t={}),a.onreadystatechange=i,a.open("get",e,!0),a.setRequestHeader("Accept","text/html")
try{a.send(t.postBody)}catch(e){t.error&&t.error()}return a},_appendNextPage:function(e){var t=this._doc
this._curPageNum+=1
var i=t.createElement("DIV")
if(i.id="readability-page-"+this._curPageNum,i.className="page",i.innerHTML='<p class="page-separator" title="Page '+this._curPageNum+'">&sect;</p>',t.getElementById("readability-content").appendChild(i),this._curPageNum>this._maxPages){var a="<div style='text-align: center'><a href='"+e+"'>View Next Page</a></div>"
return void(i.innerHTML=i.innerHTML+a)}(function(e,a){this._ajax(e,{success:function(n){var r=n.getResponseHeader("ETag")
if(r){if(r in this._pageETags)return this.log("Exact duplicate page found via ETag. Aborting."),void(i.style.display="none")
this._pageETags[r]=1}var s=t.createElement("DIV"),o=n.responseText.replace(/\n/g,"￿").replace(/<script.*?>.*?<\/script>/gi,"")
o=o.replace(/\n/g,"￿").replace(/<script.*?>.*?<\/script>/gi,""),o=o.replace(/\uffff/g,"\n").replace(/<(\/?)noscript/gi,"<$1div"),o=o.replace(this.REGEXPS.replaceFonts,"<$1span>"),s.innerHTML=o,this._replaceBrs(s),this._flags=7
var l=this._findNextPageLink(s),c=this._grabArticle(s)
if(!c)return void this.log("No content found in page to append. Aborting.")
var h=c.getElementsByTagName("P").length?c.getElementsByTagName("P")[0]:null
if(h&&h.innerHTML.length>100)for(var d=1;d<=this._curPageNum;d+=1){var g=t.getElementById("readability-page-"+d)
if(g&&-1!==g.innerHTML.indexOf(h.innerHTML))return this.log("Duplicate of page "+d+" - skipping."),i.style.display="none",void(this._parsedPages[e]=!0)}this._removeScripts(c),a.innerHTML=a.innerHTML+c.innerHTML,setTimeout(function(){this._postProcessContent(a)}.bind(this),500),l&&this._appendNextPage(l)}})}).bind(this)(e,i)},_getClassWeight:function(e){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0
var t=0
return"string"==typeof e.className&&""!==e.className&&(this.REGEXPS.negative.test(e.className)&&(t-=25),this.REGEXPS.positive.test(e.className)&&(t+=25)),"string"==typeof e.id&&""!==e.id&&(this.REGEXPS.negative.test(e.id)&&(t-=25),this.REGEXPS.positive.test(e.id)&&(t+=25)),t},_clean:function(e,t){var i=-1!==["object","embed","iframe"].indexOf(t)
this._removeNodes(e.getElementsByTagName(t),function(e){if(i){var t=[].map.call(e.attributes,function(e){return e.value}).join("|")
if(this.REGEXPS.videos.test(t))return!1
if(this.REGEXPS.videos.test(e.innerHTML))return!1}return!0})},_hasAncestorTag:function(e,t,i,a){i=i||3,t=t.toUpperCase()
for(var n=0;e.parentNode;){if(i>0&&n>i)return!1
if(e.parentNode.tagName===t&&(!a||a(e.parentNode)))return!0
e=e.parentNode,n++}return!1},_getRowAndColumnCount:function(e){for(var t=0,i=0,a=e.getElementsByTagName("tr"),n=0;n<a.length;n++){var r=a[n].getAttribute("rowspan")||0
r&&(r=parseInt(r,10)),t+=r||1
for(var s=0,o=a[n].getElementsByTagName("td"),l=0;l<o.length;l++){var c=o[l].getAttribute("colspan")||0
c&&(c=parseInt(c,10)),s+=c||1}i=Math.max(i,s)}return{rows:t,columns:i}},_markDataTables:function(e){for(var t=e.getElementsByTagName("table"),i=0;i<t.length;i++){var a=t[i]
if("presentation"!=a.getAttribute("role")){if("0"!=a.getAttribute("datatable")){if(a.getAttribute("summary"))a._readabilityDataTable=!0
else{var n=a.getElementsByTagName("caption")[0]
if(n&&n.childNodes.length>0)a._readabilityDataTable=!0
else{var r=["col","colgroup","tfoot","thead","th"],s=function(e){return!!a.getElementsByTagName(e)[0]}
if(r.some(s))this.log("Data table because found data-y descendant"),a._readabilityDataTable=!0
else if(a.getElementsByTagName("table")[0])a._readabilityDataTable=!1
else{var o=this._getRowAndColumnCount(a)
o.rows>=10||o.columns>4?a._readabilityDataTable=!0:a._readabilityDataTable=o.rows*o.columns>10}}}}else a._readabilityDataTable=!1}else a._readabilityDataTable=!1}},_cleanConditionally:function(e,t){if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)){var i="ul"===t||"ol"===t
this._removeNodes(e.getElementsByTagName(t),function(e){var t=function(e){return e._readabilityDataTable}
if(this._hasAncestorTag(e,"table",-1,t))return!1
var a=this._getClassWeight(e)
if(this.log("Cleaning Conditionally",e),a+0<0)return!0
if(this._getCharCount(e,",")<10){for(var n=e.getElementsByTagName("p").length,r=e.getElementsByTagName("img").length,s=e.getElementsByTagName("li").length-100,o=e.getElementsByTagName("input").length,l=0,c=e.getElementsByTagName("embed"),h=0,d=c.length;h<d;h+=1)this.REGEXPS.videos.test(c[h].src)||(l+=1)
var g=this._getLinkDensity(e),u=this._getInnerText(e).length
return r>1&&n/r<.5&&!this._hasAncestorTag(e,"figure")||!i&&s>n||o>Math.floor(n/3)||!i&&u<25&&(0===r||r>2)&&!this._hasAncestorTag(e,"figure")||!i&&a<25&&g>.2||a>=25&&g>.5||1===l&&u<75||l>1}return!1})}},_cleanMatchedNodes:function(e,t){for(var i=this._getNextNode(e,!0),a=this._getNextNode(e);a&&a!=i;)a=t.test(a.className+" "+a.id)?this._removeAndGetNext(a):this._getNextNode(a)},_cleanHeaders:function(e){for(var t=1;t<3;t+=1)this._removeNodes(e.getElementsByTagName("h"+t),function(e){return this._getClassWeight(e)<0})},_flagIsActive:function(e){return(this._flags&e)>0},_addFlag:function(e){this._flags=this._flags|e},_removeFlag:function(e){this._flags=this._flags&~e},isProbablyReaderable:function(e){var t=this._getAllNodesWithTag(this._doc,["p","pre"]),i=this._getAllNodesWithTag(this._doc,["div > br"])
if(i.length){var a=new Set;[].forEach.call(i,function(e){a.add(e.parentNode)}),t=[].concat.apply(Array.from(a),t)}var n=0
return this._someNode(t,function(t){if(e&&!e(t))return!1
var i=t.className+" "+t.id
if(this.REGEXPS.unlikelyCandidates.test(i)&&!this.REGEXPS.okMaybeItsACandidate.test(i))return!1
if(t.matches&&t.matches("li p"))return!1
var a=t.textContent.trim().length
return!(a<140)&&(n+=Math.sqrt(a-140))>20})},parse:function(){if(this._maxElemsToParse>0){var e=this._doc.getElementsByTagName("*").length
if(e>this._maxElemsToParse)throw new Error("Aborting parsing document; "+e+" elements found")}void 0===this._doc.documentElement.firstElementChild&&(this._getNextNode=this._getNextNodeNoElementProperties),this._removeScripts(this._doc),this._prepDocument()
var t=this._getArticleMetadata()
this._articleTitle=t.title
var i=this._grabArticle()
if(!i)return null
if(this.log("Grabbed: "+i.innerHTML),this._postProcessContent(i),!t.excerpt){var a=i.getElementsByTagName("p")
a.length>0&&(t.excerpt=a[0].textContent.trim())}var n=i.textContent
return{uri:this._uri,title:this._articleTitle,byline:t.byline||this._articleByline,dir:this._articleDir,content:i.innerHTML,textContent:n,length:n.length,excerpt:t.excerpt}}},"object"==typeof module&&(module.exports=Readability)
